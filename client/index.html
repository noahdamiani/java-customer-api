<!DOCTYPE html>
<html>
    <head>
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">

        <!-- Compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/js/materialize.min.js"></script>
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div class="col s4">
                    <h1>Customers</h1>
                    <div class="customers"></div>
                </div>
                <div class="col s4">
                    <h1>Details:</h1>
                    <div class="detail-view"></div>
                </div>
                <div class="col s4">
            <div class="row">
                <h1>Add Customer</h1>
                    <form class="col s12">
                        <div class="row">
                            <div class="input-field col s6">
                                <input placeholder="First Name" id="first_name" type="text" class="validate">
                                <label for="first_name">First Name</label>
                            </div>
                            <div class="input-field col s6">
                                <input placeholder="Last Name" id="last_name" type="text" class="validate">
                                <label for="last_name">Last Name</label>
                            </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s6">
                                    <input placeholder="Age" id="age" type="text" class="validate">
                                    <label for="age">Age</label>
                                </div>
                                <div class="input-field col s6">
                                    <input placeholder="Company" id="company" type="text" class="validate">
                                    <label for="Company">Company</label>
                                </div>
                            </div>
                            <div class="row">
                                <a class="waves-effect waves-light btn">Add</a>
                            </div>
                        </div>
                    </form>
                    </div>
                </div>
            </div>

        
        </div>

        <script>

            class App {
                constructor() {
                    this.getCustomerList();
                }
                getCustomer(id) {
                    fetch(`http://localhost:4567/customers/${id}`, { headers: { "Content-Type": "application/json; charset=utf-8" }})
                    .then(res => res.json()) // parse response as JSON (can be res.text() for plain response)
                    .then(response => {
                        let customer = response;
                        let details = response.data;
                        let detailView = document.querySelector('.detail-view');
                        let content = document.createElement('div');
                        content.innerHTML = `Name: ${details.firstName} ${details.lastName} Age: ${details.age} Company: ${details.company}`
                        detailView.innerHTML = '';
                        detailView.appendChild(content);
                    })
                    .catch(err => {
                        console.log("Error fetching customer", err);
                    });
                }
                getCustomerList() {
                    fetch("http://localhost:4567/customers", { headers: { "Content-Type": "application/json; charset=utf-8" }})
                    .then(res => res.json()) // parse response as JSON (can be res.text() for plain response)
                    .then(response => {
                        let customers = response;
                        let customerList = document.querySelector('.customers');
                        
                        for(let i = 0; i < customers.length; i++) {
                            let details = customers[i].data;
                            let customerListItem = document.createElement('div');
                            customerListItem.modelData = response[i];
                            customerListItem.addEventListener('click', (e) => this.getCustomer(e.target.modelData.id));
                            let liStr = `Name: ${details.firstName} ${details.lastName}`;
                            customerListItem.innerHTML = liStr;
                            customerList.appendChild(customerListItem);
                        }
                    })
                    .catch(err => {
                        console.log("Error fetching customer list", err);
                    });
                }
                
            }
            
            new App();
        </script>
    </body>
</html>